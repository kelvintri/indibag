<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            border: 1px solid #ef5350;
            color: #c62828;
        }
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
    </style>
</head>
<body>
    <h1>API Testing Interface</h1>

    <div class="form-section">
        <h2>Register Test</h2>
        <form id="registerForm">
            <div class="form-group">
                <label for="reg-username">Username:</label>
                <input type="text" 
                       id="reg-username" 
                       name="username" 
                       pattern="[a-zA-Z0-9_]{3,20}"
                       title="Username must be 3-20 characters long and can only contain letters, numbers, and underscores"
                       placeholder="Username (letters, numbers, underscores only)" 
                       required>
            </div>
            <div class="form-group">
                <label for="reg-email">Email:</label>
                <input type="email" id="reg-email" name="email" placeholder="Email" required>
            </div>
            <div class="form-group">
                <label for="reg-password">Password:</label>
                <input type="password" id="reg-password" name="password" placeholder="Password (min 8 characters)" required>
            </div>
            <div class="form-group">
                <label for="reg-fullname">Full Name:</label>
                <input type="text" id="reg-fullname" name="full_name" placeholder="Full Name" required>
            </div>
            <div class="form-group">
                <label for="reg-phone">Phone:</label>
                <input type="tel" id="reg-phone" name="phone" placeholder="Phone (e.g., +6281234567890)" required>
            </div>
            <button type="submit">Register</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Login Test</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" name="email" placeholder="Email" required>
            </div>
            <div class="form-group">
                <label for="login-password">Password:</label>
                <input type="password" id="login-password" name="password" placeholder="Password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Products Test</h2>
        <form id="productsForm">
            <div class="form-group">
                <label for="search">Search:</label>
                <input type="text" id="search" name="search" placeholder="Search products">
            </div>
            <div class="form-group">
                <label for="category">Category:</label>
                <input type="number" id="category" name="category" placeholder="Category ID">
            </div>
            <div class="form-group">
                <label for="brand">Brand:</label>
                <input type="number" id="brand" name="brand" placeholder="Brand ID">
            </div>
            <div class="form-group">
                <label for="sort">Sort By:</label>
                <select id="sort" name="sort">
                    <option value="newest">Newest</option>
                    <option value="oldest">Oldest</option>
                    <option value="price_low">Price Low to High</option>
                    <option value="price_high">Price High to Low</option>
                </select>
            </div>
            <div class="form-group">
                <label for="page">Page:</label>
                <input type="number" id="page" name="page" value="1" min="1">
            </div>
            <button type="submit">Get Products</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Product Detail Test</h2>
        <form id="productDetailForm">
            <div class="form-group">
                <label for="product-slug">Product Slug:</label>
                <input type="text" id="product-slug" name="slug" placeholder="Enter product slug" required>
            </div>
            <button type="submit">Get Product Details</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Categories Test</h2>
        <form id="categoriesForm">
            <button type="submit">Get All Categories</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Brands Test</h2>
        <form id="brandsForm">
            <button type="submit">Get All Brands</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Cart Test</h2>
        <form id="cartForm">
            <button type="submit">Get Cart Contents</button>
        </form>

        <h3>Add to Cart</h3>
        <form id="addToCartForm">
            <div class="form-group">
                <label for="product_id">Product ID:</label>
                <input type="number" id="product_id" name="product_id" required>
            </div>
            <div class="form-group">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" name="quantity" min="1" value="1" required>
            </div>
            <button type="submit">Add to Cart</button>
        </form>

        <h3>Update Cart Item</h3>
        <form id="updateCartForm">
            <div class="form-group">
                <label for="cart_id">Cart Item ID:</label>
                <input type="number" id="cart_id" name="cart_id" required>
            </div>
            <div class="form-group">
                <label for="update_quantity">New Quantity:</label>
                <input type="number" id="update_quantity" name="quantity" min="1" required>
            </div>
            <button type="submit">Update Cart</button>
        </form>

        <h3>Remove from Cart</h3>
        <form id="removeCartForm">
            <div class="form-group">
                <label for="remove_cart_id">Cart Item ID:</label>
                <input type="number" id="remove_cart_id" name="cart_id" required>
            </div>
            <button type="submit">Remove from Cart</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Orders Test</h2>
        <h3>Create Order</h3>
        <form id="createOrderForm">
            <!-- Address Information -->
            <h4>Shipping Address</h4>
            <div class="form-group">
                <label for="recipient_name">Recipient Name:</label>
                <input type="text" id="recipient_name" name="recipient_name" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone:</label>
                <input type="text" id="phone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="street_address">Street Address:</label>
                <textarea id="street_address" name="street_address" required></textarea>
            </div>
            <div class="form-group">
                <label for="district">District:</label>
                <input type="text" id="district" name="district" required>
            </div>
            <div class="form-group">
                <label for="city">City:</label>
                <input type="text" id="city" name="city" required>
            </div>
            <div class="form-group">
                <label for="province">Province:</label>
                <input type="text" id="province" name="province" required>
            </div>
            <div class="form-group">
                <label for="postal_code">Postal Code:</label>
                <input type="text" id="postal_code" name="postal_code" required maxlength="5">
            </div>
            <div class="form-group">
                <label for="additional_info">Additional Info:</label>
                <textarea id="additional_info" name="additional_info"></textarea>
            </div>

            <!-- Payment Method -->
            <h4>Payment Method</h4>
            <div class="form-group">
                <label for="payment_method">Payment Method:</label>
                <select id="payment_method" name="payment_method" required>
                    <option value="bank_transfer">Bank Transfer</option>
                    <option value="e-wallet">E-Wallet</option>
                </select>
            </div>

            <button type="submit">Create Order</button>
        </form>

        <h3>List Orders</h3>
        <form id="listOrdersForm">
            <div class="form-group">
                <label for="order_status">Status:</label>
                <select id="order_status" name="status">
                    <option value="">All</option>
                    <option value="pending_payment">Pending Payment</option>
                    <option value="payment_uploaded">Payment Uploaded</option>
                    <option value="payment_verified">Payment Verified</option>
                    <option value="processing">Processing</option>
                    <option value="shipped">Shipped</option>
                    <option value="delivered">Delivered</option>
                    <option value="cancelled">Cancelled</option>
                    <option value="refunded">Refunded</option>
                </select>
            </div>
            <div class="form-group">
                <label for="order_page">Page:</label>
                <input type="number" id="order_page" name="page" value="1" min="1">
            </div>
            <div class="form-group">
                <label for="order_limit">Items per page:</label>
                <input type="number" id="order_limit" name="limit" value="10" min="1" max="50">
            </div>
            <button type="submit">Get Orders</button>
        </form>

        <h3>Order Detail</h3>
        <form id="orderDetailForm">
            <div class="form-group">
                <label for="order_id">Order ID:</label>
                <input type="number" id="order_id" name="id" required>
            </div>
            <button type="submit">Get Order Details</button>
        </form>

        <h3>Cancel Order</h3>
        <form id="cancelOrderForm">
            <div class="form-group">
                <label for="cancel_order_id">Order ID:</label>
                <input type="number" id="cancel_order_id" name="order_id" required>
            </div>
            <button type="submit">Cancel Order</button>
        </form>

        <h3>Request Refund</h3>
        <form id="refundOrderForm">
            <div class="form-group">
                <label for="refund_order_id">Order ID:</label>
                <input type="number" id="refund_order_id" name="order_id" required>
            </div>
            <div class="form-group">
                <label for="refund_reason">Reason:</label>
                <textarea id="refund_reason" name="reason" required></textarea>
            </div>
            <button type="submit">Request Refund</button>
        </form>
    </div>

    <div class="form-section">
        <h2>User Addresses Test</h2>
        <form id="addressesForm">
            <button type="submit">Get User Addresses</button>
        </form>

        <h3>Create Address</h3>
        <form id="createAddressForm">
            <div class="form-group">
                <label for="addr_recipient_name">Recipient Name:</label>
                <input type="text" id="addr_recipient_name" name="recipient_name" required>
            </div>
            <div class="form-group">
                <label for="addr_phone">Phone:</label>
                <input type="text" id="addr_phone" name="phone" placeholder="e.g., +6281234567890" required>
            </div>
            <div class="form-group">
                <label for="addr_street">Street Address:</label>
                <textarea id="addr_street" name="street_address" required></textarea>
            </div>
            <div class="form-group">
                <label for="addr_district">District:</label>
                <input type="text" id="addr_district" name="district" required>
            </div>
            <div class="form-group">
                <label for="addr_city">City:</label>
                <input type="text" id="addr_city" name="city" required>
            </div>
            <div class="form-group">
                <label for="addr_province">Province:</label>
                <input type="text" id="addr_province" name="province" required>
            </div>
            <div class="form-group">
                <label for="addr_postal">Postal Code:</label>
                <input type="text" id="addr_postal" name="postal_code" maxlength="5" pattern="\d{5}" required>
            </div>
            <div class="form-group">
                <label for="addr_additional">Additional Info:</label>
                <textarea id="addr_additional" name="additional_info"></textarea>
            </div>
            <div class="form-group">
                <label for="addr_type">Address Type:</label>
                <select id="addr_type" name="address_type">
                    <option value="shipping">Shipping</option>
                    <option value="billing">Billing</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" name="is_default" value="1">
                    Set as Default Address
                </label>
            </div>
            <button type="submit">Create Address</button>
        </form>

        <h3>Update Address</h3>
        <form id="updateAddressForm">
            <div class="form-group">
                <label for="update_address_id">Address ID:</label>
                <input type="number" id="update_address_id" name="address_id" required>
            </div>
            <div class="form-group">
                <label for="update_recipient_name">Recipient Name:</label>
                <input type="text" id="update_recipient_name" name="recipient_name" required>
            </div>
            <div class="form-group">
                <label for="update_phone">Phone:</label>
                <input type="text" id="update_phone" name="phone" placeholder="e.g., +6281234567890" required>
            </div>
            <div class="form-group">
                <label for="update_street">Street Address:</label>
                <textarea id="update_street" name="street_address" required></textarea>
            </div>
            <div class="form-group">
                <label for="update_district">District:</label>
                <input type="text" id="update_district" name="district" required>
            </div>
            <div class="form-group">
                <label for="update_city">City:</label>
                <input type="text" id="update_city" name="city" required>
            </div>
            <div class="form-group">
                <label for="update_province">Province:</label>
                <input type="text" id="update_province" name="province" required>
            </div>
            <div class="form-group">
                <label for="update_postal">Postal Code:</label>
                <input type="text" id="update_postal" name="postal_code" maxlength="5" pattern="\d{5}" required>
            </div>
            <div class="form-group">
                <label for="update_additional">Additional Info:</label>
                <textarea id="update_additional" name="additional_info"></textarea>
            </div>
            <div class="form-group">
                <label for="update_type">Address Type:</label>
                <select id="update_type" name="address_type">
                    <option value="shipping">Shipping</option>
                    <option value="billing">Billing</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" name="is_default" value="1">
                    Set as Default Address
                </label>
            </div>
            <button type="submit">Update Address</button>
        </form>

        <h3>Delete Address</h3>
        <form id="deleteAddressForm">
            <div class="form-group">
                <label for="delete_address_id">Address ID:</label>
                <input type="number" id="delete_address_id" name="address_id" required>
            </div>
            <button type="submit">Delete Address</button>
        </form>
    </div>

    <div class="form-section">
        <h2>Upload Payment Proof</h2>
        <form id="uploadPaymentForm">
            <div class="form-group">
                <label for="payment_order_id">Order ID:</label>
                <input type="number" id="payment_order_id" name="order_id" required>
            </div>
            <div class="form-group">
                <label for="payment_proof">Payment Proof:</label>
                <input type="file" id="payment_proof" name="payment_proof" accept="image/*" required>
            </div>
            <button type="submit">Upload Payment</button>
        </form>
    </div>

    <div class="form-section">
        <h2>User Profile Test</h2>
        <form id="profileForm">
            <button type="submit">Get Profile</button>
        </form>

        <h3>Update Profile</h3>
        <form id="updateProfileForm">
            <div class="form-group">
                <label for="profile_full_name">Full Name:</label>
                <input type="text" id="profile_full_name" name="full_name" required>
            </div>
            <div class="form-group">
                <label for="profile_phone">Phone:</label>
                <input type="text" id="profile_phone" name="phone" placeholder="e.g., +6281234567890" required>
            </div>
            <button type="submit">Update Profile</button>
        </form>

        <h3>Change Password</h3>
        <form id="changePasswordForm">
            <div class="form-group">
                <label for="current_password">Current Password:</label>
                <input type="password" id="current_password" name="current_password" required>
            </div>
            <div class="form-group">
                <label for="new_password">New Password:</label>
                <input type="password" id="new_password" name="new_password" required minlength="8">
            </div>
            <div class="form-group">
                <label for="confirm_password">Confirm Password:</label>
                <input type="password" id="confirm_password" name="confirm_password" required minlength="8">
            </div>
            <button type="submit">Change Password</button>
        </form>
    </div>

    <div id="result"></div>

    <script>
        async function handleSubmit(endpoint, formElement, event) {
            event.preventDefault();
            
            // Add loading state
            formElement.classList.add('loading');
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Processing...';
            
            const formData = new FormData(formElement);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                // Format and display result
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                // Clear form on success
                if (result.success) {
                    formElement.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            } finally {
                formElement.classList.remove('loading');
            }
        }

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            handleSubmit('/api/v1/auth/register', this, e);
        });

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            handleSubmit('/api/v1/auth/login', this, e);
        });

        document.getElementById('productsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const params = new URLSearchParams();
            
            // Add non-empty parameters
            for (const [key, value] of formData.entries()) {
                if (value) {
                    params.append(key, value);
                }
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching products...';
            
            try {
                const response = await fetch(`/api/v1/products?${params.toString()}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        document.getElementById('productDetailForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const slug = document.getElementById('product-slug').value;
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching product details...';
            
            try {
                const response = await fetch(`/api/v1/products/${encodeURIComponent(slug)}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Categories list handler
        document.getElementById('categoriesForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching categories...';
            
            try {
                const response = await fetch('/api/v1/categories', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Brands list handler
        document.getElementById('brandsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching brands...';
            
            try {
                const response = await fetch('/api/v1/brands', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Cart handler
        document.getElementById('cartForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching cart...';
            
            try {
                const response = await fetch('/api/v1/cart', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Add to Cart handler
        document.getElementById('addToCartForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                product_id: parseInt(formData.get('product_id')),
                quantity: parseInt(formData.get('quantity'))
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Adding to cart...';
            
            try {
                const response = await fetch('/api/v1/cart/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Update Cart handler
        document.getElementById('updateCartForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                cart_id: parseInt(formData.get('cart_id')),
                quantity: parseInt(formData.get('quantity'))
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Updating cart...';
            
            try {
                const response = await fetch('/api/v1/cart/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Remove from Cart handler
        document.getElementById('removeCartForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const cart_id = parseInt(formData.get('cart_id'));
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Removing from cart...';
            
            try {
                const response = await fetch(`/api/v1/cart/remove?cart_id=${cart_id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Create Order handler
        document.getElementById('createOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                shipping_address: {
                    recipient_name: formData.get('recipient_name'),
                    phone: formData.get('phone'),
                    street_address: formData.get('street_address'),
                    district: formData.get('district'),
                    city: formData.get('city'),
                    province: formData.get('province'),
                    postal_code: formData.get('postal_code'),
                    additional_info: formData.get('additional_info'),
                    address_type: 'shipping'
                },
                payment_method: formData.get('payment_method')
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Creating order...';
            
            try {
                const response = await fetch('/api/v1/orders/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // User Addresses handler
        document.getElementById('addressesForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching addresses...';
            
            try {
                const response = await fetch('/api/v1/user/addresses', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Create Address handler
        document.getElementById('createAddressForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                recipient_name: formData.get('recipient_name'),
                phone: formData.get('phone'),
                street_address: formData.get('street_address'),
                district: formData.get('district'),
                city: formData.get('city'),
                province: formData.get('province'),
                postal_code: formData.get('postal_code'),
                additional_info: formData.get('additional_info'),
                address_type: formData.get('address_type'),
                is_default: formData.get('is_default') === '1'
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Creating address...';
            
            try {
                const response = await fetch('/api/v1/user/addresses/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Update Address handler
        document.getElementById('updateAddressForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                address_id: parseInt(formData.get('address_id')),
                recipient_name: formData.get('recipient_name'),
                phone: formData.get('phone'),
                street_address: formData.get('street_address'),
                district: formData.get('district'),
                city: formData.get('city'),
                province: formData.get('province'),
                postal_code: formData.get('postal_code'),
                additional_info: formData.get('additional_info'),
                address_type: formData.get('address_type'),
                is_default: formData.get('is_default') === '1' ? 1 : 0
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Updating address...';
            
            try {
                const response = await fetch('/api/v1/user/addresses/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Delete Address handler
        document.getElementById('deleteAddressForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const address_id = document.getElementById('delete_address_id').value;
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Deleting address...';
            
            try {
                const response = await fetch(`/api/v1/user/addresses/delete?address_id=${address_id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // List Orders handler
        document.getElementById('listOrdersForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const params = new URLSearchParams();
            
            for (const [key, value] of formData.entries()) {
                if (value) {
                    params.append(key, value);
                }
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching orders...';
            
            try {
                const response = await fetch(`/api/v1/orders?${params.toString()}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Order Detail handler
        document.getElementById('orderDetailForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const order_id = document.getElementById('order_id').value;
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching order details...';
            
            try {
                const response = await fetch(`/api/v1/orders/${order_id}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Format the display
                    const order = result.data;
                    let html = `
                        <h3>Order #${order.order_number}</h3>
                        <p>Status: ${order.status}</p>
                        <p>Total Amount: ${order.total_amount}</p>
                        
                        <h4>Payment Information</h4>
                        <p>Method: ${order.payment_method}</p>
                        <p>Status: ${order.payment.status}</p>
                    `;

                    // Show transfer proof if uploaded
                    if (order.payment.transfer_proof_url) {
                        html += `
                            <div>
                                <h4>Transfer Proof</h4>
                                <img src="${order.payment.transfer_proof_url}" style="max-width: 300px;">
                                <p>Uploaded: ${order.payment.payment_date}</p>
                                ${order.payment.verified_at ? 
                                    `<p>Verified by: ${order.payment.verified_by} on ${order.payment.verified_at}</p>` : 
                                    '<p>Pending verification</p>'
                                }
                            </div>
                        `;
                    }

                    // Show upload button if payment proof needed
                    if (order.payment.needs_upload) {
                        html += `
                            <div>
                                <p>Please upload your payment proof</p>
                                <button onclick="showUploadForm(${order.id})">Upload Payment Proof</button>
                            </div>
                        `;
                    }

                    resultDiv.innerHTML = html;
                    resultDiv.className = 'success';
                } else {
                    resultDiv.textContent = JSON.stringify(result, null, 2);
                    resultDiv.className = 'error';
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Upload Payment handler
        document.getElementById('uploadPaymentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const order_id = document.getElementById('payment_order_id').value;
            const file = document.getElementById('payment_proof').files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const formData = new FormData();
            formData.append('payment_proof', file);
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Uploading payment proof...';
            
            try {
                const response = await fetch(`/api/v1/orders/${order_id}/upload-payment`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Helper function to show upload form
        function showUploadForm(orderId) {
            document.getElementById('payment_order_id').value = orderId;
            document.getElementById('uploadPaymentForm').scrollIntoView({ behavior: 'smooth' });
        }

        // User Profile handler
        document.getElementById('profileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Fetching profile...';
            
            try {
                const response = await fetch('/api/v1/user/profile', {
                    method: 'GET',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Update Profile handler
        document.getElementById('updateProfileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                full_name: formData.get('full_name'),
                phone: formData.get('phone')
            };
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Updating profile...';
            
            try {
                const response = await fetch('/api/v1/user/profile/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Change Password handler
        document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                current_password: formData.get('current_password'),
                new_password: formData.get('new_password'),
                confirm_password: formData.get('confirm_password')
            };
            
            // Client-side validation
            if (data.new_password !== data.confirm_password) {
                alert('Passwords do not match');
                return;
            }
            
            if (data.new_password.length < 8) {
                alert('Password must be at least 8 characters long');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Changing password...';
            
            try {
                const response = await fetch('/api/v1/user/profile/password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Cancel Order handler
        document.getElementById('cancelOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const order_id = document.getElementById('cancel_order_id').value;
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Cancelling order...';
            
            try {
                const response = await fetch(`/api/v1/orders/${order_id}/cancel`, {
                    method: 'PUT',
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });

        // Request Refund handler
        document.getElementById('refundOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const order_id = document.getElementById('refund_order_id').value;
            const reason = document.getElementById('refund_reason').value;
            
            const resultDiv = document.getElementById('result');
            resultDiv.className = '';
            resultDiv.textContent = 'Requesting refund...';
            
            try {
                const response = await fetch(`/api/v1/orders/${order_id}/refund`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ reason }),
                    credentials: 'include'
                });
                
                const result = await response.json();
                resultDiv.textContent = JSON.stringify(result, null, 2);
                resultDiv.className = result.success ? 'success' : 'error';
                
                if (result.success) {
                    this.reset();
                }
                
            } catch (error) {
                resultDiv.textContent = `Error: ${error.message}`;
                resultDiv.className = 'error';
            }
        });
    </script>
</body>
</html> 